"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.MarketParams = void 0;
const morpho_ts_1 = require("@morpho-org/morpho-ts");
const errors_js_1 = require("../errors.js");
const MarketUtils_js_1 = require("./MarketUtils.js");
/**
 * Represents a market's configuration (also called market params).
 */
class MarketParams {
    static _CACHE = {};
    /**
     * Returns the previously cached market config for the given id, if any.
     * @throws {UnknownMarketParamsError} If no market config is cached.
     */
    static get(id) {
        const marketParams = MarketParams._CACHE[id];
        if (!marketParams)
            throw new errors_js_1.UnknownMarketParamsError(id);
        return marketParams;
    }
    /**
     * Returns the canonical idle market configuration for the given loan token.
     */
    static idle(token) {
        return new MarketParams({
            collateralToken: morpho_ts_1.ZERO_ADDRESS,
            loanToken: token,
            oracle: morpho_ts_1.ZERO_ADDRESS,
            irm: morpho_ts_1.ZERO_ADDRESS,
            lltv: 0n,
        });
    }
    /**
     * The market's collateral token address.
     */
    collateralToken;
    /**
     * The market's loan token address.
     */
    loanToken;
    /**
     * The market's oracle address.
     */
    oracle;
    /**
     * The market's interest rate model address.
     */
    irm;
    /**
     * The market's liquidation Loan-To-Value (scaled by WAD).
     */
    lltv;
    /**
     * The market's hex-encoded id, defined as the hash of the market params.
     */
    id; // Cached because params are readonly.
    /**
     * The market's liquidation incentive factor.
     */
    liquidationIncentiveFactor; // Cached because lltv is readonly.
    constructor(params) {
        const { collateralToken, loanToken, oracle, irm, lltv } = params;
        this.collateralToken = collateralToken;
        this.loanToken = loanToken;
        this.oracle = oracle;
        this.irm = irm;
        this.lltv = BigInt(lltv);
        this.id = MarketUtils_js_1.MarketUtils.getMarketId(params);
        this.liquidationIncentiveFactor =
            MarketUtils_js_1.MarketUtils.getLiquidationIncentiveFactor(params);
        MarketParams._CACHE[this.id] = this;
    }
}
exports.MarketParams = MarketParams;
