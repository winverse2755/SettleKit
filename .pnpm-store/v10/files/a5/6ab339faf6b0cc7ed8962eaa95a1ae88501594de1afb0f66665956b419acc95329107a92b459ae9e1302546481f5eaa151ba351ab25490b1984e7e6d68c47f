"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.getChecksumedAddress = exports.isZeroAddressOrUnset = exports.safeParseUnits = exports.safeParseNumber = exports.safeGetAddress = void 0;
const morpho_ts_1 = require("@morpho-org/morpho-ts");
const ethers_1 = require("ethers");
// Alternative to Number.toFixed that doesn't use scientific notation for excessively small or large numbers.
const toFixed = (x, decimals) => new Intl.NumberFormat("en-US", {
    style: "decimal",
    useGrouping: false,
    maximumFractionDigits: decimals,
    minimumFractionDigits: decimals,
}).format(x);
const safeGetAddress = (address) => (0, ethers_1.getAddress)(address.toLowerCase());
exports.safeGetAddress = safeGetAddress;
const safeParseNumber = (value, decimals = 18) => (0, exports.safeParseUnits)(toFixed(value, decimals), decimals);
exports.safeParseNumber = safeParseNumber;
const safeParseUnits = (strValue, decimals = 18) => {
    if (!/[-+]?[0-9]*\.?[0-9]+/.test(strValue))
        throw Error(`invalid number: ${strValue}`);
    let [whole, dec = ""] = strValue.split(".");
    dec = dec.slice(0, decimals);
    return (0, ethers_1.parseUnits)([whole || "0", dec].filter((v) => v.length > 0).join("."), decimals);
};
exports.safeParseUnits = safeParseUnits;
/**
 * Check if an address is the zero address, null, or undefined.
 *
 * @param address - The address to check, which can be a valid address, null, or undefined.
 * @returns True if the address is zero, null, or undefined; otherwise, false.
 */
const isZeroAddressOrUnset = (address) => address == null || address === morpho_ts_1.ZERO_ADDRESS;
exports.isZeroAddressOrUnset = isZeroAddressOrUnset;
/**
 * Transform an AddressLike into a checksumed address
 *
 * @param address Address to transform
 */
const getChecksumedAddress = async (address) => {
    const awaited = await address;
    // Ethers getAddress function is throwing an error if the address is already checksumed
    if (typeof awaited === "string")
        return (0, ethers_1.getAddress)(awaited.toLowerCase());
    return (0, ethers_1.getAddress)((await awaited.getAddress()).toLowerCase());
};
exports.getChecksumedAddress = getChecksumedAddress;
