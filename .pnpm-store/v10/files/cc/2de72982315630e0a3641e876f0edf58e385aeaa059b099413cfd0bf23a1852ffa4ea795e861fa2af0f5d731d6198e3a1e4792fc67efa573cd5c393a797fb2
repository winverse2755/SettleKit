"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.getPermit2Message = exports.getPermit2TransferFromMessage = void 0;
const blue_sdk_1 = require("@morpho-org/blue-sdk");
const utils_1 = require("./utils");
const getPermit2TransferFromMessage = (args, chainId) => {
    const domain = {
        name: "Permit2",
        chainId: chainId.toString(),
        verifyingContract: (0, blue_sdk_1.getChainAddresses)(chainId).permit2,
    };
    const types = {
        PermitTransferFrom: [
            { name: "permitted", type: "TokenPermissions" },
            { name: "spender", type: "address" },
            { name: "nonce", type: "uint256" },
            { name: "deadline", type: "uint256" },
        ],
        TokenPermissions: [
            { name: "token", type: "address" },
            { name: "amount", type: "uint256" },
        ],
    };
    const value = {
        permitted: {
            token: args.erc20,
            amount: blue_sdk_1.MathLib.min(args.allowance, blue_sdk_1.MathLib.MAX_UINT_160),
        },
        spender: args.spender,
        nonce: args.nonce,
        deadline: args.deadline,
    };
    return (0, utils_1.getMessage)(domain, types, value);
};
exports.getPermit2TransferFromMessage = getPermit2TransferFromMessage;
const getPermit2Message = (args, chainId) => {
    const domain = {
        name: "Permit2",
        chainId: chainId.toString(),
        verifyingContract: (0, blue_sdk_1.getChainAddresses)(chainId).permit2,
    };
    const types = {
        PermitSingle: [
            {
                name: "details",
                type: "PermitDetails",
            },
            {
                name: "spender",
                type: "address",
            },
            {
                name: "sigDeadline",
                type: "uint256",
            },
        ],
        PermitDetails: [
            {
                name: "token",
                type: "address",
            },
            {
                name: "amount",
                type: "uint160",
            },
            {
                name: "expiration",
                type: "uint48",
            },
            {
                name: "nonce",
                type: "uint48",
            },
        ],
    };
    const value = {
        details: {
            token: args.erc20,
            amount: blue_sdk_1.MathLib.min(args.allowance, blue_sdk_1.MathLib.MAX_UINT_160),
            // Use an unlimited expiration because it most
            // closely mimics how a standard approval works.
            expiration: blue_sdk_1.MathLib.min(args.expiration ?? blue_sdk_1.MathLib.MAX_UINT_48, blue_sdk_1.MathLib.MAX_UINT_48),
            nonce: args.nonce,
        },
        spender: args.spender,
        sigDeadline: args.deadline,
    };
    return (0, utils_1.getMessage)(domain, types, value);
};
exports.getPermit2Message = getPermit2Message;
