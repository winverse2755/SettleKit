"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.fetchMarketParams = fetchMarketParams;
const ethers_types_1 = require("ethers-types");
const blue_sdk_1 = require("@morpho-org/blue-sdk");
async function fetchMarketParams(id, runner, { chainId } = {}) {
    let config = (0, blue_sdk_1._try)(() => blue_sdk_1.MarketParams.get(id), blue_sdk_1.UnknownMarketParamsError);
    if (!config) {
        chainId ??= Number((await runner.provider.getNetwork()).chainId);
        const { morpho } = (0, blue_sdk_1.getChainAddresses)(chainId);
        const marketParams = await ethers_types_1.MorphoBlue__factory.connect(morpho, runner).idToMarketParams(id, {
            // Always fetch at latest block because config is immutable.
            blockTag: "latest",
        });
        config = new blue_sdk_1.MarketParams({
            lltv: marketParams.lltv,
            loanToken: marketParams.loanToken,
            collateralToken: marketParams.collateralToken,
            irm: marketParams.irm,
            oracle: marketParams.oracle,
        });
    }
    return config;
}
